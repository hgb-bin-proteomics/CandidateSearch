<?xml version='1.0' encoding='UTF-8' standalone='no'?>
<section xmlns="http://docbook.org/ns/docbook" version="5.0" xmlns:xlink="http://www.w3.org/1999/xlink" xml:id="_md__r_e_a_d_m_e" xml:lang="en-US">
<title>CandidateSearch</title>
<indexterm><primary>CandidateSearch</primary></indexterm>

<para><anchor xml:id="_md__r_e_a_d_m_e_1autotoc_md0"/> Proof-of-concept implementation of a search engine that uses <link xlink:href="https://github.com/hgb-bin-proteomics/CandidateVectorSearch">CandidateVectorSearch</link> to identify the best peptide candidates for a given mass spectrum. <emphasis><link linkend="_namespace_candidate_search">CandidateSearch</link></emphasis> creates the vector encodings of peptides and spectra that are needed for the sparse matrix search of <emphasis>CandidateVectorSearch</emphasis>.</para>

<para><emphasis><link linkend="_namespace_candidate_search">CandidateSearch</link></emphasis> can identify peptide candidates from a given mass spectrum without any precursor ion/mass information and no previous knowledge about potential fixed or variable modifications. <emphasis><link linkend="_namespace_candidate_search">CandidateSearch</link></emphasis> can also identify peptidoform candidates if a set of fixed and variable modifications is provided. The aim of <emphasis><link linkend="_namespace_candidate_search">CandidateSearch</link></emphasis> is to reduce the search space for a given identification task by filtering out unlikely peptide or peptidoform candidates. It is <emphasis role="bold">NOT</emphasis> meant to be a standalone search engine for peptide/peptidoform identification.</para>

<para>A simplified break down of the <emphasis><link linkend="_namespace_candidate_search">CandidateSearch</link></emphasis> algorithm is given in the following:<itemizedlist>
<listitem>
<para>Read the given MS2 spectra from the mgf file.</para>
</listitem><listitem>
<para>Generate the encoding vectors for each spectrum.</para>
</listitem><listitem>
<para>Transform spectrum encoding vectors into the representation needed for <emphasis>CandidateVectorSearch</emphasis>.</para>
</listitem><listitem>
<para>Read the given fasta file.</para>
</listitem><listitem>
<para>Digest the proteins of the fasta file into peptides.</para>
</listitem><listitem>
<para>[Optional] Generate decoy peptides and peptidoforms.</para>
</listitem><listitem>
<para>Calculate theoretical ion m/z values for all peptides.</para>
</listitem><listitem>
<para>Generate the encoding vectors for each peptide.</para>
</listitem><listitem>
<para>Transform the peptide encoding vectors into the representation needed for <emphasis>CandidateVectorSearch</emphasis>.</para>
</listitem><listitem>
<para>Run <emphasis>CandidateVectorSearch</emphasis>.</para>
</listitem><listitem>
<para>Process the results of <emphasis>CandidateVectorSearch</emphasis>.</para>
</listitem><listitem>
<para>Create a csv file that maps every spectrum (scan number) to a list of the best <emphasis>n</emphasis> peptide candidates.</para>
</listitem><listitem>
<para>Done!</para>
</listitem></itemizedlist>
</para>
<section xml:id="_md__r_e_a_d_m_e_1autotoc_md1">
<title>Usage</title>

<para>Running <emphasis><link linkend="_namespace_candidate_search">CandidateSearch</link></emphasis> requires three files:<itemizedlist>
<listitem>
<para>An mgf file containing MS2 spectra.</para>
</listitem><listitem>
<para>A fasta file containing sample proteins.</para>
</listitem><listitem>
<para>A settings file containing parameters for digestion, ion calculation and search (see below for an explanation of the settings file).</para>
</listitem></itemizedlist>
</para>

<para>The <emphasis><link linkend="_namespace_candidate_search">CandidateSearch</link></emphasis> executable can then be run like this:</para>

<para><literallayout><computeroutput>CandidateSearch.exe&#32;spectra.mgf&#32;database.fasta&#32;settings.txt
</computeroutput></literallayout></para>

<para>Example files that can be used to test <emphasis><link linkend="_namespace_candidate_search">CandidateSearch</link></emphasis> can be found in <computeroutput>/data</computeroutput>.</para>
</section>
<section xml:id="_md__r_e_a_d_m_e_1autotoc_md2">
<title>Settings</title>

<para>The settings file accepts the following parameters:<itemizedlist>
<listitem>
<para>MAX_CLEAVAGES: The maximum number of allowed missed cleavages during digestion. (integer, default = 2)</para>
</listitem><listitem>
<para>MIN_PEP_LENGTH: The minimum length of a peptide to be considered for search. (integer, default = 5)</para>
</listitem><listitem>
<para>MAX_PEP_LENGTH: The maximum length of a peptide to be considered for search. (integer, default = 30)</para>
</listitem><listitem>
<para>MAX_PRECURSOR_CHARGE: The maximum considered precursor ion charge. (integer, default = 4)</para>
</listitem><listitem>
<para>MAX_FRAGMENT_CHARGE: The maximum considered fragment ion charge. (string, default = +1)</para>
</listitem><listitem>
<para>MAX_NEUTRAL_LOSSES: The maximum number of neutral losses considered during ion calculation. (integer, default = 1)</para>
</listitem><listitem>
<para>MAX_NEUTRAL_LOSS_MODS: The maximum number of neutral loss modifications considered during ion calculation. (integer, default = 2)</para>
</listitem><listitem>
<para>FIXED_MODIFICATIONS: Fixed modifications that should be considered during search given as <computeroutput>(char)amino_acid:(double)modification_mass</computeroutput>. An example would be carbamidomethylation of cysteine, which would be denoted as <computeroutput>C:57.021464;</computeroutput>. Several fixed modifications can be provided. (string, default = None)</para>
</listitem><listitem>
<para>VARIABLE_MODIFICATIONS: Variable modifications that should be considered during search given as <computeroutput>(char)amino_acid:(double)modification_mass</computeroutput>. An example would be oxidation of methionine, which would be denoted as <computeroutput>M:15.994915;</computeroutput>. Several variable modifications can be provided. If no modifications are given, <emphasis><link linkend="_namespace_candidate_search">CandidateSearch</link></emphasis> will return the best scoring unmodified peptidoforms for a given spectrum. (string, default = None)</para>
</listitem><listitem>
<para>DECOY_SEARCH: Whether decoy search should be performed or not. Accepts <computeroutput>true</computeroutput> or <computeroutput>false</computeroutput>. (bool, default = true)</para>
</listitem><listitem>
<para>TOP_N: The number of best candidates that should be returned by the search. (integer, default = 1000)</para>
</listitem><listitem>
<para>TOLERANCE: Tolerance used for matching theoretical ions to experimental peaks. Given in Dalton. (double, default = 0.02)</para>
</listitem><listitem>
<para>NORMALIZE: Whether or not <emphasis>CandidateVectorSearch</emphasis> scores should be normalized before selecting the best <emphasis>n</emphasis> candidates. Accepts <computeroutput>true</computeroutput> or <computeroutput>false</computeroutput>. (bool, default = false)</para>
</listitem><listitem>
<para>USE_GAUSSIAN: Whether or not experimental peaks should be modelled as gaussian distributions with <computeroutput>mu = (m/z)</computeroutput> and <computeroutput>sigma = (tolerance/3)</computeroutput>. Accepts <computeroutput>true</computeroutput> or <computeroutput>false</computeroutput>. (bool, default = true) <?linebreak?></para>
</listitem><listitem>
<para>MODE: Search approach used by <emphasis>CandidateVectorSearch</emphasis>. One of the following (default = CPU_DV):<itemizedlist>
<listitem>
<para>CPU_DV: Sparse matrix - dense vector search on the CPU.</para>
</listitem><listitem>
<para>CPU_DM: Sparse matrix - dense matrix search on the CPU.</para>
</listitem><listitem>
<para>CPU_SV: Sparse matrix - sparse vector search on the CPU.</para>
</listitem><listitem>
<para>CPU_SM: Sparse matrix - sparse matrix search on the CPU.</para>
</listitem><listitem>
<para>GPU_DV: Sparse matrix - dense vector search on the GPU (see <link xlink:href="https://github.com/hgb-bin-proteomics/CandidateVectorSearch/blob/master/README.md">requirements</link>).</para>
</listitem><listitem>
<para>GPU_DM: Sparse matrix - dense matrix search on the GPU (see <link xlink:href="https://github.com/hgb-bin-proteomics/CandidateVectorSearch/blob/master/README.md">requirements</link>).</para>
</listitem><listitem>
<para>GPU_SM: Sparse matrix - sparse matrix search on the GPU (see <link xlink:href="https://github.com/hgb-bin-proteomics/CandidateVectorSearch/blob/master/README.md">requirements</link>).</para>
</listitem></itemizedlist>
</para>
</listitem></itemizedlist>
</para>

<para>For the last five parameters you might additionally want to check the documentation of <link xlink:href="https://github.com/hgb-bin-proteomics/CandidateVectorSearch">CandidateVectorSearch</link> to get a better understanding of their meaning.</para>

<para>An empty <computeroutput>settings.txt</computeroutput> file is a valid configuration for search (default parameters will be used), however not providing a settings file at all is not valid.</para>

<para>An example <computeroutput>settings.txt</computeroutput> file is provided <link xlink:href="https://github.com/hgb-bin-proteomics/CandidateSearch/blob/master/settings.txt">here</link>.</para>

<para>Additionally its contents are listed below, which should help in understanding the formatting:</para>

<para><literallayout><computeroutput>##&#32;DIGESTIONS&#32;PARAMETERS
MAX_CLEAVAGES&#32;=&#32;2
MIN_PEP_LENGTH&#32;=&#32;5
MAX_PEP_LENGTH&#32;=&#32;30

##&#32;ION&#32;CALCULATION&#32;PARAMETERS
MAX_PRECURSOR_CHARGE&#32;=&#32;4
MAX_FRAGMENT_CHARGE&#32;=&#32;+1
MAX_NEUTRAL_LOSSES&#32;=&#32;1
MAX_NEUTRAL_LOSS_MODS&#32;=&#32;2
#FIXED_MODIFICATIONS&#32;=&#32;None
FIXED_MODIFICATIONS&#32;=&#32;C:57.021464;
#VARIABLE_MODIFICATIONS&#32;=&#32;None
VARIABLE_MODIFICATIONS&#32;=&#32;M:15.994915;
#VARIABLE_MODIFICATIONS&#32;=&#32;M:15.994915;K:284.173607;

##&#32;SEARCH&#32;PARAMETERS
DECOY_SEARCH&#32;=&#32;true

##&#32;VECTOR&#32;SEARCH&#32;PARAMETERS
TOP_N&#32;=&#32;1000
TOLERANCE&#32;=&#32;0.02
NORMALIZE&#32;=&#32;false
USE_GAUSSIAN&#32;=&#32;true
MODE&#32;=&#32;CPU_DV
</computeroutput></literallayout></para>
</section>
<section xml:id="_md__r_e_a_d_m_e_1autotoc_md3">
<title>Documentation</title>

<para>The code of this search engine is fully documented within the <computeroutput>.cs</computeroutput> code files. A good entry point is the main function of <emphasis><link linkend="_namespace_candidate_search">CandidateSearch</link></emphasis> which is implemented <link xlink:href="https://github.com/hgb-bin-proteomics/CandidateSearch/blob/master/CandidateSearch.cs">here</link>. Documentation generated by <link xlink:href="https://github.com/doxygen/doxygen">Doxygen</link> is also available here: <link xlink:href="https://hgb-bin-proteomics.github.io/CandidateSearch/">https://hgb-bin-proteomics.github.io/CandidateSearch/</link></para>
</section>
<section xml:id="_md__r_e_a_d_m_e_1autotoc_md4">
<title>Limitations</title>

<para>This a proof-of-concept implementation that shows the applicability of our <emphasis>CandidateVectorSearch</emphasis> approach and not a fully fledged search engine, therefore this implementation comes with a few limitations:</para>

<para><itemizedlist>
<listitem>
<para>We currently only have implemented tryptic digestion.<itemizedlist>
<listitem>
<para>You can implement your own digestion <link xlink:href="https://github.com/hgb-bin-proteomics/CandidateSearch/blob/master/amanda/FASTAParser.cs#L17-L22">here</link>.</para>
</listitem></itemizedlist>
</para>
</listitem><listitem>
<para>We currently have not implemented support for N- or C-terminal modifications.</para>
</listitem><listitem>
<para>We currently have only implemented support for one possible modification per amino acid.</para>
</listitem><listitem>
<para>We only support spectra in centroid mode (we can&apos;t really do anything with spectra in profile mode).</para>
</listitem></itemizedlist>
</para>
</section>
<section xml:id="_md__r_e_a_d_m_e_1autotoc_md5">
<title>Results</title>

<para>Example results of <emphasis><link linkend="_namespace_candidate_search">CandidateSearch</link></emphasis> and results analysis are given in <computeroutput>tests</computeroutput>.</para>

<para></para>

<para><emphasis role="bold">Figure 1:</emphasis> Identifying peptide candidates and peptidoform candidates with <emphasis><link linkend="_namespace_candidate_search">CandidateSearch</link></emphasis> in a <link xlink:href="https://www.ebi.ac.uk/pride/archive/projects/PXD007750">HeLa dataset</link> using the human swissprot database. The considered ground truth was an <link xlink:href="https://ms.imp.ac.at/?goto=msamanda">MS Amanda</link> search validated with <link xlink:href="https://github.com/percolator/percolator">Percolator</link>. For every high-confidence PSM we checked if the identified peptide/peptidoform was among the top 50/100/500/1000 hits of <emphasis><link linkend="_namespace_candidate_search">CandidateSearch</link></emphasis>. We reach almost 100% coverage within the first 1000 hits of <emphasis><link linkend="_namespace_candidate_search">CandidateSearch</link></emphasis> (for reference: the whole database contained ~4 200 000 peptides or ~10 500 000 peptidoforms).</para>
</section>
<section xml:id="_md__r_e_a_d_m_e_1autotoc_md6">
<title>Known Issues</title>

<para><link xlink:href="https://github.com/hgb-bin-proteomics/CandidateSearch/issues">List of known issues</link></para>
</section>
<section xml:id="_md__r_e_a_d_m_e_1autotoc_md7">
<title>Citing</title>

<para>If you are using [parts of] <emphasis><link linkend="_namespace_candidate_search">CandidateSearch</link></emphasis> please cite:</para>

<para><literallayout><computeroutput>MS&#32;Annika&#32;3.0&#32;(publication&#32;wip)
</computeroutput></literallayout></para>
</section>
<section xml:id="_md__r_e_a_d_m_e_1autotoc_md8">
<title>License</title>

<para><itemizedlist>
<listitem>
<para><link xlink:href="https://github.com/hgb-bin-proteomics/CandidateSearch/blob/master/LICENSE">MIT</link></para>
</listitem></itemizedlist>
</para>
</section>
<section xml:id="_md__r_e_a_d_m_e_1autotoc_md9">
<title>Contact</title>

<para><link xlink:href="mailto:micha.birklbauer@fh-hagenberg.at">micha.birklbauer@fh-hagenberg.at</link> </para>
</section>
</section>
